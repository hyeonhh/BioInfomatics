# Seurat Single-Cell RNA-Seq Analysis Pipeline

- 본 분석 파이프라인은 Seurat 패키지를 사용하여 단일 세포 RNA 시퀀싱 데이터를 처리하고, 클러스터링 및 세포 유형을 정의하는 전체 과정을 설명합니다.
- tutorial : [https://satijalab.org/seurat/articles/visualization_vignette](https://satijalab.org/seurat/articles/pbmc3k_tutorial)

------------------------------------------------------------------------

## 1. 데이터 로딩 및 초기화

-   **데이터 불러오기:** `Read10X()` 함수를 사용하여 10X Genomics raw 데이터를 불러옵니다.
-   **Seurat 객체 생성:** `CreateSeuratObject()`로 데이터를 Seurat 객체로 초기화합니다.
-   **필터링 조건:** 최소 200개의 feature(유전자)와 3개 이상의 세포를 가진 데이터를 사용합니다.

## 2. 데이터 탐색 및 메모리 효율 비교

-   **데이터 확인:** 특정 유전자의 발현 수준을 확인합니다.
-   **희소행렬 vs 밀집행렬 비교:** `object.size()` 함수를 통해 메모리 사용량을 측정하고, 희소행렬(sparse matrix)이 메모리 효율이 더 뛰어남을 확인합니다.

## 3. 데이터 전처리

-   **미토콘드리아 유전자 비율 계산:** `PercentageFeatureSet()` 함수로 미토콘드리아 유전자 발현 비율을 계산하고 시각화합니다.
-   **세포 필터링:** `nFeature_RNA > 200`, `nFeature_RNA < 2500`, `percent.mt < 5` 조건을 만족하는 세포만 분석에 포함합니다.

## 4. 정규화 및 변수 선택

-   **정규화:** `NormalizeData()` 함수를 사용하여 RNA 발현량을 로그 정규화(LogNormalize)합니다.
-   **변화가 큰 유전자 선택:** `FindVariableFeatures()` 함수를 통해 변동성이 큰 상위 2,000개의 유전자를 선택합니다.

## 5. 데이터 스케일링 및 차원 축소

-   **스케일링:** `ScaleData()` 함수로 각 유전자의 평균을 0, 분산을 1로 맞추고, 미토콘드리아 유전자(`percent.mt`)의 영향을 제거합니다.
-   **PCA 수행:** `RunPCA()`로 주성분 분석을 수행하고, `ElbowPlot()`을 통해 적절한 주성분 개수(보통 10\~30개)를 결정합니다.

## 6. 세포 클러스터링

-   **이웃 계산:** `FindNeighbors()`를 이용해 PCA 결과 기반으로 K-최근접 이웃(KNN) 그래프를 생성합니다.
-   **클러스터 분리:** `FindClusters()`로 Louvain 알고리즘을 적용해 세포들을 클러스터로 분리합니다.

## 7. 데이터 시각화

-   **UMAP/tSNE 실행:** `RunUMAP()` 함수로 비선형 차원 축소(UMAP)를 수행합니다.
-   **클러스터 시각화:** `DimPlot()` 함수로 클러스터별 세포 분포를 2D 공간에 시각화합니다.
-   **클러스터 마커 발현 시각화:** `FeaturePlot()`, `VlnPlot()` 등을 통해 유전자 발현 위치와 분포를 확인합니다.

## 8. 클러스터 마커 탐색

-   **대표 유전자 찾기:** `FindMarkers()` 함수로 특정 클러스터에 특이적으로 발현되는 마커 유전자를 찾습니다.
-   **전체 클러스터 마커 검색:** `FindAllMarkers()`로 모든 클러스터에 대한 마커 유전자를 자동 탐색합니다.
-   **히트맵 생성:** `DoHeatmap()` 함수를 사용해 클러스터별 마커 유전자 발현 히트맵을 생성합니다.

## 9. 세포 유형 정의

-   **클러스터 이름 지정:** 알려진 대표 마커 유전자를 기반으로 클러스터 번호를 세포 유형명(예: "Naive CD4 T")으로 매핑합니다.
-   **클러스터명 변경:** `RenameIdents()` 함수를 이용해 클러스터 이름을 변경합니다.

## 10. 결과 저장

-   **분석 결과 저장:** `saveRDS()`로 Seurat 객체를 파일로 저장해 재사용 및 공유가 가능합니다.
-   **UMAP 플롯 저장:** `ggplot2` 패키지를 사용하여 UMAP 클러스터 플롯을 이미지 파일로 저장합니다.

------------------------------------------------------------------------
